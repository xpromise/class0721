# Vue 原理

## 响应式原理

1. 数据代理：将 `data` 中的数据代理 `this` 上，访问数据更方便

- 详细版

  - 将 `data` 数据赋值给变量 `data` 和 `this._data` 上，这种数据称为原数据
  - 通过 `Object.keys` 方法提取原数据的所有属性名成为一个数组
  - 遍历这个数据，调用 `_proxy` 对每一个属性名进行数据代理
  - 所谓数据：就是通过 `Object.defineProperty` 方法给 `this` 定义这个属性，设置属性的元属性（属性描述符）
  - 元属性中定义数据的是否可枚举，是否可以重新配置，以及 `get` 属性读取方法 和 `set` 属性的设置方法
  - `get` 和 `set` 方法本质上都是对之前的原数据进行操作
  - 到此所有数据都会定义在 `this` 上，所以可以通过 `this` 直接访问 `data` 中数据了

- 简单版
  - 遍历所有原数据中属性进行数据代理，通过 `Object.defineProperty` 方法给 `this` 添加属性，定义其 `get` 和 `set` 方法，内部实际读取、设置还是原数据的值

2. 数据劫持：重新定义 data 原数据上的属性，将其定义响应式属性

- 详细版

  - 调用 observe 方法开始数据劫持，传入 data 原数据
  - 判断数据是否是对象或数组，是的话才会开始真正的工作 new Obverser(data)
  - 内部通过 `Object.keys` 方法提取原 data 数据的所有属性名成为一个数组
  - 遍历这个数组，提取属性名和属性值，调用 defineReactive 方法将其定义成响应式
  - 先 new Dep() 生成 dep 对象，这个 dep 可以做两件事
    - 可以通过建立响应式联系（dep.depend）
    - 可以触发响应式更新（dep.notify）
    - 每个响应式数据都会产生一个自己的 dep，它是唯一的
  - 递归调用 observe 函数，对属性值进行处理
    - 它的目的为了确保所有数据（对象上对象上的数据）都变成响应式
  - 通过 `Object.defineProperty` 方法给原数据 data 重新定义属性，定义其属性 `get` 和 `set` 方法，
    - get 方法会返回原数据（内部会有 dep.depend 方法）
    - set 方法设置新值，通过调用 observe 方法将新值重新定义成响应式（内部会有 dep.notify 方法）
      - 确保将来所有 data 数据都是响应式（不管是之前的，还是新添加的）
  - 此时 data 数据就全部重新定义了，定义成响应式，响应式的关键点还是看下一步

- 简单版
  - 内部会递归遍历所有 data 数据，将其定义成响应式
  - 每个响应式数据都会产生一个自己的 dep，它是唯一的，和响应式关系很大
  - 通过 `Object.defineProperty` 方法给原数据 data 重新定义属性，定义其属性 `get` 和 `set` 方法

3. 模板解析

- 到此建立响应式联系

## 双向数据绑定原理
